(() => {
  const H=`.harvest-timer.styled{-webkit-font-smoothing:antialiased;background-image:linear-gradient(#fff,#eee);border:1px solid #bbb;border-radius:2px;color:#222;cursor:pointer;display:inline-block;font:inherit;font-size:0;height:12px;line-height:1;margin:0;padding:3px;position:relative;vertical-align:top;width:12px}.harvest-timer.styled:hover{background-image:linear-gradient(#f8f8f8,#e8e8e8)}.harvest-timer.styled:active{background:#eee;box-shadow:inset 0 1px 4px #0000001a}.harvest-timer.styled:after{background:url("data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20width='16'%20height='16'%20viewBox='0%200%2024%2024'%20fill='none'%20stroke='currentColor'%20stroke-width='2'%20stroke-linecap='round'%20stroke-linejoin='round'%20aria-label='Clock%20icon'%3e%3ccircle%20cx='12'%20cy='12'%20r='10'%20/%3e%3cpolyline%20points='12%206%2012%2012%2016%2014'%20/%3e%3c/svg%3e") 50% 50% no-repeat;content:"";display:inline-block;font:inherit;height:100%;left:0;margin:0;padding:0;position:absolute;top:0;width:100%}.harvest-timer.styled.running{background-image:linear-gradient(#53b2fc,#1385e5);border-color:#075fa9;color:#fff}.harvest-timer.styled.running:hover{background-image:linear-gradient(#49a4fd,#0e7add)}.harvest-timer.styled.running:active{background:#1385e5;box-shadow:inset 0 1px 5px #0003}#harvest-iframe{background:white;border:none;border-radius:6px;box-shadow:0 6px 12px #0003,0 0 0 1px #0000001a;height:300px;left:50%;margin:0 0 0 -250px;overflow:hidden;padding:0;position:absolute;top:0;transition:height .15s;width:500px}@media (min-height: 400px){#harvest-iframe{top:10%}}@media (min-height: 550px){#harvest-iframe{top:20%}}.harvest-overlay{background:rgba(0,0,0,.6);height:100%;left:0;opacity:1;overflow:scroll;position:fixed;top:0;width:100%;z-index:9998}`;(function(){const w="https://platform.harvestapp.com";let T,E,g,C,x,k,L,v,_,j,y,P,f,l;return E=class{constructor(){this.el=document.createElement("div"),this.el.className="harvest-overlay",this.iframe=document.createElement("iframe"),this.iframe.id="harvest-iframe",this.el.appendChild(this.iframe),this.el.addEventListener("click",e=>this.close()),document.addEventListener("keyup",({which:e})=>{if(e===27)return this.close()})}open(e){return this.iframe.src=e,document.body.appendChild(this.el)}adjustHeight(e){return this.iframe.style.height=`${e}px`}close(){let e;return(e=this.el.parentNode)!=null?e.removeChild(this.el):void 0}},v=new E,document.getElementById("harvest-worker")||(f=document.createElement("iframe"),f.hidden=!0,f.id="harvest-worker",f.src=`${w}/platform/worker`,document.body.appendChild(f)),(l=document.getElementById("harvest-messaging"))||(l=document.createElement("div"),l.id="harvest-messaging",l.hidden=!0,document.body.appendChild(l)),j=function(i){let e,t;return function(){let r;r=[];for(e in i)t=i[e],t!=null&&r.push(`${e}=${encodeURIComponent(t)}`);return r}().join("&")},g=function(){return window._harvestPlatformConfig?window._harvestPlatformConfig:JSON.parse(document.querySelector("script[data-platform-config]").dataset.platformConfig)},x=function(i){let e,t,r,n,o;for(e={},o=["account","item","group","default","skip-styling"],t=0,n=o.length;t<n;t++)r=o[t],e[r]=k(i,r);return e.group==null&&(e.group=k(i,"project")),e.permalink=i.getAttribute("data-permalink"),e},k=function(i,e){let t;return t=function(){let r;try{return JSON.parse((r=i.getAttribute(`data-${e}`))!=null?r:"null")}catch{}}(),(t!=null?t.id:void 0)!=null&&(t.id=""+t.id),t},y=function(i){let e,t,r,n,o,a,c,m,h,b;for(L=i,c=document.querySelectorAll(".harvest-timer"),b=[],n=0,a=c.length;n<a;n++)t=c[n],{group:r,item:o}=x(t),i==null||(r!=null?r.id:void 0)!==((m=i.group)!=null?m.id:void 0)||(o!=null?o.id:void 0)!==((h=i.item)!=null?h.id:void 0)?(t.classList.remove("running"),b.push(function(){let s,p,d,u;for(d=t.children,u=[],s=0,p=d.length;s<p;s++)e=d[s],u.push(e.classList.remove("running"));return u}())):(t.classList.add("running"),b.push(function(){let s,p,d,u;for(d=t.children,u=[],s=0,p=d.length;s<p;s++)e=d[s],u.push(e.classList.add("running"));return u}()));return b},P=function(){return y(null)},C=function(i,e){return i!=null&&e!=null&&(e.account!=null&&(i=i.replace("%ACCOUNT_ID%",e.account.id)),e.group!=null&&(i=i.replace("%PROJECT_ID%",e.group.id)),e.group!=null&&(i=i.replace("%GROUP_ID%",e.group.id)),e.item!=null&&(i=i.replace("%ITEM_ID%",e.item.id))),i},_=function(i,e){return window.jQuery!=null?window.jQuery(l).bind(i,e):l.addEventListener(i,e)},window.addEventListener("message",function(i){if(i.origin!==w)return;const e=i.data;let t,r,n,o;switch({type:n,value:o}=e??{},n){case"frame:close":return v.close();case"frame:resize":return v.adjustHeight(o);case"timer:started":return{id:t,group_id:r}=o.external_reference,y({group:{id:r},item:{id:t}});case"timer:stopped":return P()}}),T=class{constructor({stylesheet:e}){let t,r;this.addTimers=this.addTimers.bind(this),this.findTimers=this.findTimers.bind(this),this.stylesheet=e,r=document.createElement("style"),document.head.appendChild(r),r.appendChild(document.createTextNode(this.stylesheet)),_("harvest-event:timers:add",this.addTimers),_("harvest-event:timers:chrome:add",this.findTimers),this.findTimers(),l.setAttribute("data-ready",!0),t=document.createEvent("CustomEvent"),t.initCustomEvent("harvest-event:ready",!0,!0,{}),(document.body||l).dispatchEvent(t)}addTimers(e){let t,r,n,o;if(t=e.element||((r=e.originalEvent)!=null&&(n=r.detail)!=null?n.element:void 0)||((o=e.detail)!=null?o.element:void 0),(t!=null?t.jquery:void 0)!=null&&(t=t.get(0)),t)return this.findTimer(t)}findTimers(){let e,t,r,n,o,a;for(a=".harvest-timer:not([data-listening])",t=document.querySelectorAll(a),o=[],r=0,n=t.length;r<n;r++)e=t[r],o.push(this.findTimer(e));return o}findTimer(e){let t,r;return t=e.getAttribute("data-skip-styling"),r=g().skipStyling||e.classList.contains("styled")||t!=null&&t!==!1&&t!=="false",r||e.classList.add("styled"),e.addEventListener("click",n=>(n.stopPropagation(),this.openIframe(x(e)))),y(L),e.setAttribute("data-listening",!0)}openIframe(e){let t,r,n,o,a,c,m,h;return t={app_name:g().applicationName,service:e.service||window.location.hostname,permalink:e.permalink||C(g().permalink,e),external_account_id:(r=e.account)!=null?r.id:void 0,external_group_id:(n=e.group)!=null?n.id:void 0,external_group_name:(o=e.group)!=null?o.name:void 0,external_item_id:(a=e.item)!=null?a.id:void 0,external_item_name:(c=e.item)!=null?c.name:void 0,default_project_code:(m=e.default)!=null?m.project_code:void 0,default_project_name:(h=e.default)!=null?h.project_name:void 0},v.open(`${w}/platform/timer?${j(t)}`)}},window.postMessage==null?typeof console<"u"&&console!==null?console.warn(`Harvest Platform is disabled.
To start and stop timers, cross-domain messaging must be supported
by your browser.`):void 0:!window.XMLHttpRequest||!("withCredentials"in new XMLHttpRequest)?typeof console<"u"&&console!==null?console.warn(`Harvest Platform is disabled.
To check for running timers, xhr requests with credentials must be
supported by your browser.`):void 0:self.HarvestPlatform!=null?self.HarvestPlatform.findTimers():self.HarvestPlatform=new T({stylesheet:H})})();
//# sourceMappingURL=platform.js.map
})()
